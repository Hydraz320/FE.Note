# 输完url发生了什么

[参考](http://igoro.com/archive/what-really-happens-when-you-navigate-to-a-url/)

[参考](http://www.jianshu.com/p/3944732228f0)

1. 当发送一个URL请求时，不管这个URL是Web页面的URL还是Web页面上每个资源的URL，浏览器都会开启一个线程来处理这个请求，分析链接指向的URL；

2. 浏览器向远程DNS服务器发出请求，启动一个DNS查询，使浏览器获得请求对应的IP地址；

3. 浏览器与远程Web服务器通过TCP三次握手协商来建立一个TCP/IP连接。

4. 一旦 TCP/IP 连接建立，浏览器会通过该连接向远程服务器发送HTTP的GET请求。

5. 进入到web服务器上的 Web Server，如 Apache、Tomcat、Node.JS 等服务器;

6、进入部署好的后端应用，如 PHP、Java、JavaScript、Python 等，找到对应的请求处理;

7、处理结束回馈报头，此处如果浏览器访问过，缓存上有对应资源，会与服务器最后修改时间对比，一致则返回304

8. 远程服务器找到资源并使用 HTTP 响应返回该资源，值为200的HTTP响应状态表示一个正确的响应。

9. 此时，Web 服务器提供资源服务，客户端开始下载资源。

10. 释放TCP连接。

11. 页面开始渲染DOM，JS根据DOM API操作DOM,执行事件绑定,其他Ajax请求等，页面显示完成(可以讲img.load、domready、onready)。

## ARP

(DNS是域名系统，应用层协议，用于将域名->ip；ARP是地址解析协议，网络层协议，用于将ip->MAC)

主机A的IP地址为192.168.1.1，MAC地址为0A-11-22-33-44-01；

主机B的IP地址为192.168.1.2，MAC地址为0A-11-22-33-44-02；

当主机A要与主机B通信时，地址解析协议可以将主机B的IP地址（192.168.1.2）解析成主机B的MAC地址，以下为工作流程：

第1步：根据主机A上的路由表内容，IP确定用于访问主机B的转发IP地址是192.168.1.2。然后A主机在自己的本地ARP缓存中检查主机B的匹配MAC地址。

第2步：如果主机A在ARP缓存中没有找到映射，它将询问192.168.1.2的硬件地址，从而将ARP请求帧广播到本地网络上的所有主机。源主机A的IP地址和MAC地址都包括在ARP请求中。本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配。如果主机发现请求的IP地址与自己的IP地址不匹配，它将丢弃ARP请求。

第3步：主机B确定ARP请求中的IP地址与自己的IP地址匹配，则将主机A的IP地址和MAC地址映射添加到本地ARP缓存中。

第4步：主机B将包含其MAC地址的ARP回复消息直接发送回主机A。

第5步：当主机A收到从主机B发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了。





